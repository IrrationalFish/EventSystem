<!DOCTYPE html>
<html>
<head>
    <title>Geolocation</title>
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no">
    <meta charset="utf-8">
    <link rel = "stylesheet" type = "text/css" href = "indexstyle.css">
</head>
<script src = loadMap.js></script>
<script src = toolbarControl.js></script>
<script src = sideBarControl.js></script>
<script src = myList.js></script>
<script src = logIn.js></script>
<script src = logOut.js></script>
<script src = "dateFilter.js"></script>
<script src="http://cdn.static.runoob.com/libs/jquery/1.10.2/jquery.min.js"></script>
<script src="jquery.cookie.js"></script>
<script src = cookie.js></script>
<script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBn_FQZui6V8Xe-70bjODMQc93WcWRm_CQ&callback=initMap"></script>

<body>
<div id = "login">
    <script>
        if(getCookie("userID")!=undefined&&getCookie("userID")!="null"){    //於：如果cookie存在，不需要登录
            $("#login").hide();
            thisUserName = getCookie("userName");       //於：用cookie给变量赋值
            thisUserID = getCookie("userID");
        }else{
            $("#login").show();
        }
    </script>
        <div class="form">
            <div class="register-form" id="2" style="display: none;">
                <input type="text" placeholder="name" id="unamereg" name="unamereg"/>
                <input type="password" placeholder="password" id="pswreg" name="pswreg"/>
                <input type="text" placeholder="email address" id="emailreg" name="emailreg"/>
                <button onclick="signUp()">create</button>
                <p class="message">Already registered? <a href="javascript:void(0) " onclick="changeForm()">Sign In</a></p>
            </div>
            <div class="login-form" id="1" style="display: block;">
                <input type="text" placeholder="username" id="unamein" name="unamein"/>
                <input type="password" placeholder="password" id="pswin" name="pswin"/>
                <button id="loginButton"onclick="closeUp()">login</button>  <!--於：添加了ID，用于登录验证时把文字变成Connecting...-->
                <p class="message">Not registered? <a href="javascript:void(0) " onclick="changeForm()">Create an account</a></p>
            </div>
        </div>
</div>


<div id="map"></div>

<div class="username">
    <button onclick="logOut()" class="logout" onmouseover="showTex()" onmouseout="hideTex()" id="logout">
        <script> 
            document.write(thisUserName);
        </script>
    </button>
</div>

<div class = "toolpanel">
    <div class = "clock">
        <button id = "clock" onclick="showFullClock()"  style="width : 150px"></button>
    </div>
    <div class = "btn-group">
        <button onclick="viewLocation()">LOC</button>
        <button onclick="viewNext()">NXT</button>
        <button onclick="viewPop()">POP</button>
    </div>
</div>

<div id="mySidenav" class="sidenav" style="width : 15px">
    <a href="javascript:void(0)" class="openbtn" id="openbtn" onclick="openNav()">\></a>
    <div id="SidenavCon" class="sidenavcon" style="display: none">
        <div class="tab">
            <button class="tablinks" id="myListButton" onclick="openForm(event, 'myListMenu');">MYLIST</button>
            <button class="tablinks" id="allListButton" onclick="openForm(event, 'allListMenu');">ALL EVENTS</button>    <!--於：改名-->
            <button class="tablinks" id="popularListButton" onclick="openForm(event, 'popularListMenu')">POPULAR</button>      <!--於：改名-->
        </div>


        <div id="myListMenu" class="tabcontent">        <!--於：此div原本id是mylist，和下面myList易混淆，修改，74行修改-->
            <table id="dateFilter">                         <!--於：时间筛选器-->
                <tr>
                    <td><labelfor="fromDate">From：</label></td>
                    <td><input id="fromDate" type="date" max="" onchange="setMinMaxDate(1,'from')"/></td>
                </tr>
                <tr>
                    <td><label for="toDate">To：</label></td>
                    <td><input id="toDate" type="date" min="" onchange="setMinMaxDate(1,'to')"/></td>
                </tr>
                <script>getDateFilterCookie();</script>
            </table>
            <div class="searcharea" >
                <input type="text" placeholder="Search..." onkeyup="search(this.value)">
            </div>
            <ul id = "showMyList" class="myList"></ul>
        </div>

        <div id="allListMenu" class="tabcontent">           <!--於：all events list-->
            <table id="dateFilter">                         <!--於：时间筛选器-->
                <tr>
                    <td><label for="fromDate2">From：</label></td>      <!--於：这里的两个id后面要加2-->
                    <td><input id="fromDate2" type="date" max="" onchange="setMinMaxDate(2,'from')"/></td>
                </tr>
                <tr>
                    <td><label for="toDate2">To：</label></td>
                    <td><input id="toDate2" type="date" min="" onchange="setMinMaxDate(2,'to')"/></td>
                </tr>
            </table>
            <div class="searcharea" >
                <input type="text" placeholder="Search..." onkeyup="search(this.value)">
            </div>
            <ul id = "showAllEventsList" class="allEventsList"></ul>
        </div>

        <div id="popularListMenu" class="tabcontent">           <!--於：popular list-->
            <table id="dateFilter">                         <!--於：时间筛选器-->
                <tr>
                    <td><labe lfor="fromDate3">From：</label></td>        <!--於：这里的两个id后面要加3-->
                    <td><input id="fromDate3" type="date" max="" onchange="setMinMaxDate(3,'from')"/></td>
                </tr>
                <tr>
                    <td><label for="toDate3">To：</label></td>
                    <td><input id="toDate3" type="date" min="" onchange="setMinMaxDate(3,'to')"/></td>
                </tr>
            </table>
            <div class="searcharea" >
                <input type="text" placeholder="Search..." onkeyup="search(this.value)">
            </div>
            <ul id = "showPopularList" class="popularList"></ul>
        </div>
        <script>
            allLine();
            showAllEventsList();
            showPopularList();
            if(getCookie('isSideNavOpen')=='null'||getCookie('isSideNavOpen')==undefined){
                setCookie('isSideNavOpen','false');
            }
            if(getCookie('currentMenu')=='null'||getCookie('currentMenu')==undefined){
                setCookie('currentMenu','myListMenu');
            }
            if(getCookie('isSideNavOpen')=='false'){
                //do nothing
            }else if(getCookie('isSideNavOpen')=='true'){
                openNav()
            }
            if(getCookie('currentMenu')=='myListMenu'){
                $(".tablinks#myListButton").attr("class","tablinks active");
                $("#myListMenu").css("display","block");    //於：开始时根据cookie显示menu
            }else if(getCookie('currentMenu')=='allListMenu'){
                $(".tablinks#allListButton").attr("class","tablinks active");
                $("#allListMenu").css("display","block");
            }else if(getCookie('currentMenu')=='popularListMenu'){
                $(".tablinks#popularListButton").attr("class","tablinks active");
                $("#popularListMenu").css("display","block");
            }
            
        </script>
    </div>
</div>

</body>
</html>